{{- $ctx := . -}}
{{ include "lib.configmap" $ctx }}
---
{{ include "lib.service" $ctx }}
---
{{ include "lib.deployment" $ctx }}

{{- if .Values.ingress.enabled }}
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
	name: {{ include "lib.fullname" . }}
	{{- with .Values.ingress.annotations }}
	annotations:
		{{- toYaml . | nindent 4 }}
	{{- end }}
spec:
	{{- with .Values.ingress.className }}
	ingressClassName: {{ . }}
	{{- end }}
	rules:
		{{- range .Values.ingress.hosts }}
		- host: {{ .host | quote }}
			http:
				paths:
					{{- range .paths }}
					- path: {{ .path }}
						pathType: {{ .pathType }}
						backend:
							service:
								name: {{ include "lib.fullname" $ctx }}
								port:
									number: 80
					{{- end }}
		{{- end }}
	{{- if .Values.ingress.tls }}
	tls:
		{{- toYaml .Values.ingress.tls | nindent 4 }}
	{{- end }}
{{- end }}
